{"title":"基于信创国产化离线实施部署的问题记录合集","date":"2025-04-18T06:18:43.842Z","slug":"信创国产化问题合集","comments":true,"tags":["信创","国产操作系统","离线部署","统信","飞腾","鲲鹏","麒麟","龙芯"],"updated":"2025-04-18T07:28:12.122Z","content":"<h2 id=\"环境信息\">环境信息<a href=\"post/信创国产化问题合集#环境信息\"></a></h2><ul>\n<li>CPU<br> 飞腾D2000，鲲鹏920，龙芯3A6000</li>\n<li>GPU<br> JM7200</li>\n<li>操作系统<br> 统信服务器操作系统V20 1070e-ARM64、统信服务器操作系统V20 1070-LoongArch64、统信UOS桌面专业版ARM64（1070版本）<br> A版：基于CentOS技术路线，A版采用的是openAnolis技术路线。<br> C版：基于CentOS社区发行版进行二次商业化发行的Linux操作系统。<br> D版：D版采用的是Debian技术路线。<br> E版：E版采用的是openEuler技术路线。</li>\n<li>数据库<br> OceanBase</li>\n</ul>\n<h2 id=\"问题合集\">问题合集<a href=\"post/信创国产化问题合集#问题合集\"></a></h2><h3 id=\"1-安装统信v20问题合集\">1.安装统信v20问题合集<a href=\"post/信创国产化问题合集#1-安装统信v20问题合集\"></a></h3><h4 id=\"1-1-镜像下载\">1.1.镜像下载<a href=\"post/信创国产化问题合集#1-1-镜像下载\"></a></h4><p>在统信<a href=\"https://www.chinauos.com/resource/download-professional\" target=\"_blank\" rel=\"noopener\">资源中心</a>下载对应的系统镜像。</p>\n<h4 id=\"1-2-安装系统报dracut-initqueue错误。\">1.2.安装系统报dracut-initqueue错误。<a href=\"post/信创国产化问题合集#1-2-安装系统报dracut-initqueue错误。\"></a></h4><p>在制作U盘启动后，不要修改U盘名称，修改名称后会导致引导问题。</p>\n<h3 id=\"2-挂载扩展硬盘\">2.挂载扩展硬盘<a href=\"post/信创国产化问题合集#2-挂载扩展硬盘\"></a></h3><p>具体步骤见：<a href=\"/post/mount-disk-on-centos-by-fdisk\">CentOS上通过fdisk分区并挂载硬盘</a><br>大于2T的硬盘需先格式化为GPT格式，具体命令fdisk会提示，按照提示输入命令即可。</p>\n<h3 id=\"3-设置本地源\">3.设置本地源<a href=\"post/信创国产化问题合集#3-设置本地源\"></a></h3><p>写入的U盘镜像中带有通用的基础安装包，将U盘根路径、AppStream路径写入到，编辑<code>/etc/yum.repos.d</code>其中一个repo文件中即可。<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[UnionTechOS-Server-20-root]</span><br><span class=\"line\">name=UnionTechOS-Server-20-root</span><br><span class=\"line\">baseurl=file:///media/UOS</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">gpgkey=https://euler-packages.chinauos.com/server-euler/<span class=\"variable\">$StateMode</span>/fuyu/<span class=\"variable\">$releasever</span>/everything/<span class=\"variable\">$basearch</span>/RPM-GPG-KEY-UnionTech</span><br><span class=\"line\">username=<span class=\"variable\">$auth_u</span></span><br><span class=\"line\">password=<span class=\"variable\">$auth_p</span></span><br><span class=\"line\">[UnionTechOS-Server-20-AppStream]</span><br><span class=\"line\">name=UnionTechOS-Server-20-AppStream</span><br><span class=\"line\">baseurl=file:///media/UOS/AppStream</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">gpgkey=https://euler-packages.chinauos.com/server-euler/<span class=\"variable\">$StateMode</span>/fuyu/<span class=\"variable\">$releasever</span>/everything/<span class=\"variable\">$basearch</span>/RPM-GPG-KEY-UnionTech</span><br><span class=\"line\">username=<span class=\"variable\">$auth_u</span></span><br><span class=\"line\">password=<span class=\"variable\">$auth_p</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"4-安装Nginx\">4.安装Nginx<a href=\"post/信创国产化问题合集#4-安装Nginx\"></a></h3><p>具体步骤见：<a href=\"/post/compile-nginx-on-centos\">CentOS编译安装Nginx并启用Brotli压缩和HTTP2</a></p>\n<h3 id=\"5-OceanBase问题合集\">5.OceanBase问题合集<a href=\"post/信创国产化问题合集#5-OceanBase问题合集\"></a></h3><h4 id=\"5-1安装集群报OBD-2008-Cluster-clocks-are-out-of-sync错误\">5.1安装集群报OBD-2008 : Cluster clocks are out of sync错误<a href=\"post/信创国产化问题合集#5-1安装集群报OBD-2008-Cluster-clocks-are-out-of-sync错误\"></a></h4><p>由于集群服务器之间的时间不一致导致的问题，将其中一台服务器作为时间服务器即可。</p>\n<ul>\n<li>时间服务器(192.168.0.2)<br>编辑<code>/etc/chrony.conf</code>并写入<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Use public servers from the pool.ntp.org project.</span></span><br><span class=\"line\"><span class=\"comment\"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class=\"line\"><span class=\"comment\">#pool pool.ntp.org iburst</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Record the rate at which the system clock gains/losses time.</span></span><br><span class=\"line\">driftfile /var/lib/chrony/drift</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Allow the system clock to be stepped in the first three updates</span></span><br><span class=\"line\"><span class=\"comment\"># if its offset is larger than 1 second.</span></span><br><span class=\"line\">makestep 1.0 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable kernel synchronization of the real-time clock (RTC).</span></span><br><span class=\"line\">rtcsync</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable hardware timestamping on all interfaces that support it.</span></span><br><span class=\"line\"><span class=\"comment\">#hwtimestamp *</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Increase the minimum number of selectable sources required to adjust</span></span><br><span class=\"line\"><span class=\"comment\"># the system clock.</span></span><br><span class=\"line\"><span class=\"comment\">#minsources 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 允许3段其他机器访问</span></span><br><span class=\"line\">allow 192.168.0.0/24</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 本机提供时间服务</span></span><br><span class=\"line\"><span class=\"built_in\">local</span> stratum 10</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Specify file containing keys for NTP authentication.</span></span><br><span class=\"line\"><span class=\"comment\">#keyfile /etc/chrony.keys</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Get TAI-UTC offset and leap seconds from the system tz database.</span></span><br><span class=\"line\"><span class=\"comment\">#leapsectz right/UTC</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Specify directory for log files.</span></span><br><span class=\"line\">logdir /var/<span class=\"built_in\">log</span>/chrony</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Select which information is logged.</span></span><br><span class=\"line\"><span class=\"comment\">#log measurements statistics tracking</span></span><br><span class=\"line\"><span class=\"comment\">#server ntp.ntsc.ac.cn</span></span><br><span class=\"line\">server 192.168.0.2</span><br><span class=\"line\">cmdport 0</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>然后重启服务<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart chronyd</span><br></pre></td></tr></table></figure></p>\n<p>查看是否开启同步<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">timedatectl</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>其他机器同步.2的时间(192.168.0.3)<br>编辑<code>/etc/chrony.conf</code>并写入<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Use public servers from the pool.ntp.org project.</span></span><br><span class=\"line\"><span class=\"comment\"># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span></span><br><span class=\"line\"><span class=\"comment\">#server 0.centos.pool.ntp.org iburst</span></span><br><span class=\"line\"><span class=\"comment\">#server 1.centos.pool.ntp.org iburst</span></span><br><span class=\"line\"><span class=\"comment\">#server 2.centos.pool.ntp.org iburst</span></span><br><span class=\"line\"><span class=\"comment\">#server 3.centos.pool.ntp.org iburst</span></span><br><span class=\"line\">server 192.168.0.2 iburst</span><br><span class=\"line\"><span class=\"comment\"># Record the rate at which the system clock gains/losses time.</span></span><br><span class=\"line\">driftfile /var/lib/chrony/drift</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Allow the system clock to be stepped in the first three updates</span></span><br><span class=\"line\"><span class=\"comment\"># if its offset is larger than 1 second.</span></span><br><span class=\"line\">makestep 1.0 3</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable kernel synchronization of the real-time clock (RTC).</span></span><br><span class=\"line\">rtcsync</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Enable hardware timestamping on all interfaces that support it.</span></span><br><span class=\"line\"><span class=\"comment\">#hwtimestamp *</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Increase the minimum number of selectable sources required to adjust</span></span><br><span class=\"line\"><span class=\"comment\"># the system clock.</span></span><br><span class=\"line\"><span class=\"comment\">#minsources 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Allow NTP client access from local network.</span></span><br><span class=\"line\"><span class=\"comment\">#allow 192.168.0.0/16</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Serve time even if not synchronized to a time source.</span></span><br><span class=\"line\"><span class=\"comment\">#local stratum 10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Specify file containing keys for NTP authentication.</span></span><br><span class=\"line\"><span class=\"comment\">#keyfile /etc/chrony.keys</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Specify directory for log files.</span></span><br><span class=\"line\">logdir /var/<span class=\"built_in\">log</span>/chrony</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Select which information is logged.</span></span><br><span class=\"line\"><span class=\"comment\">#log measurements statistics tracking</span></span><br><span class=\"line\">```    </span><br><span class=\"line\">重启服务</span><br><span class=\"line\">```bash</span><br><span class=\"line\">systemctl restart chronyd</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>同步时间<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chronyc -a makestep</span><br></pre></td></tr></table></figure></p>\n<p>查看时间同步偏差<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chronyc sources</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"6-解压中文文件名乱码\">6.解压中文文件名乱码<a href=\"post/信创国产化问题合集#6-解压中文文件名乱码\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unzip -O cp936 test.zip</span><br></pre></td></tr></table></figure>\n<h3 id=\"7-设置固定IP\">7.设置固定IP<a href=\"post/信创国产化问题合集#7-设置固定IP\"></a></h3><p>编辑<code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>并写入<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DEVICE=eth0</span><br><span class=\"line\">BOOTPROTO=none</span><br><span class=\"line\">ONBOOT=yes</span><br><span class=\"line\">IPADDR=192.168.0.2</span><br><span class=\"line\">NETMASK=255.255.255.0</span><br><span class=\"line\">GATEWAY=192.168.0.1</span><br><span class=\"line\">DNS1=</span><br><span class=\"line\">DNS2=</span><br></pre></td></tr></table></figure></p>\n<p>重载网络<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl restart network</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"8-开启端口\">8.开启端口<a href=\"post/信创国产化问题合集#8-开启端口\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start firewalld</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=8080-8085/tcp --permanent</span><br><span class=\"line\">firewall-cmd --reload</span><br><span class=\"line\">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>\n<h3 id=\"9-下载离线rpm包\">9.下载离线rpm包<a href=\"post/信创国产化问题合集#9-下载离线rpm包\"></a></h3><p>在公网服务器执行命令：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dnf install nginx --downloadonly --downloaddir=/root/nginx</span><br></pre></td></tr></table></figure></p>\n<p>然后在把下载的内容放到离线服务器上执行命令：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ivh *.rpm</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"10-查看yum仓库信息\">10.查看yum仓库信息<a href=\"post/信创国产化问题合集#10-查看yum仓库信息\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum repolist -v</span><br></pre></td></tr></table></figure>\n<h3 id=\"11-飞腾D2000安装Windows-10\">11.飞腾D2000安装Windows 10<a href=\"post/信创国产化问题合集#11-飞腾D2000安装Windows-10\"></a></h3><ul>\n<li>1.下载并安装<a href=\"https://www.phytium.com.cn/developer/repository/\" target=\"_blank\" rel=\"noopener\">PhyFusion（统信版）</a></li>\n<li>2.下载<a href=\"https://uupdump.net/known.php?q=windows+10\" target=\"_blank\" rel=\"noopener\">Windows 10 Arm镜像</a></li>\n<li>3.运行<code>PhyFusion</code>并导入Windows 10 Arm镜像</li>\n<li>4.运行exe程序即可。</li>\n<li>5.如果有硬件设备，需在<code>PhyFusion</code>中将设备共享。</li>\n</ul>\n","prev":{"title":"JavaScript 简写与高效写法手册","slug":"javascript-shortcuts-summary"},"next":{"title":"使用 Dify 创建基于大模型的发票识别 Agent","slug":"使用 Dify 创建基于大模型的发票识别 Agent"},"link":"https://www.alipay.one/post/信创国产化问题合集/","toc":[{"title":"环境信息","id":"环境信息","index":"1"},{"title":"问题合集","id":"问题合集","index":"2","children":[{"title":"1.安装统信v20问题合集","id":"1-安装统信v20问题合集","index":"2.1","children":[{"title":"1.1.镜像下载","id":"1-1-镜像下载","index":"2.1.1"},{"title":"1.2.安装系统报dracut-initqueue错误。","id":"1-2-安装系统报dracut-initqueue错误。","index":"2.1.2"}]},{"title":"2.挂载扩展硬盘","id":"2-挂载扩展硬盘","index":"2.2"},{"title":"3.设置本地源","id":"3-设置本地源","index":"2.3"},{"title":"4.安装Nginx","id":"4-安装Nginx","index":"2.4"},{"title":"5.OceanBase问题合集","id":"5-OceanBase问题合集","index":"2.5","children":[{"title":"5.1安装集群报OBD-2008 : Cluster clocks are out of sync错误","id":"5-1安装集群报OBD-2008-Cluster-clocks-are-out-of-sync错误","index":"2.5.1"}]},{"title":"6.解压中文文件名乱码","id":"6-解压中文文件名乱码","index":"2.6"},{"title":"7.设置固定IP","id":"7-设置固定IP","index":"2.7"},{"title":"8.开启端口","id":"8-开启端口","index":"2.8"},{"title":"9.下载离线rpm包","id":"9-下载离线rpm包","index":"2.9"},{"title":"10.查看yum仓库信息","id":"10-查看yum仓库信息","index":"2.10"},{"title":"11.飞腾D2000安装Windows 10","id":"11-飞腾D2000安装Windows-10","index":"2.11"}]}]}