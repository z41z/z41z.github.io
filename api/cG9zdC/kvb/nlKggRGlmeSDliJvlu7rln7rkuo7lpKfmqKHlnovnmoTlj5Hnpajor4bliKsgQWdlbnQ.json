{"title":"使用 Dify 创建基于大模型的发票识别 Agent","date":"2025-02-20T00:58:52.278Z","slug":"使用 Dify 创建基于大模型的发票识别 Agent","comments":true,"tags":["AI","Dify","人工智能","发票识别","大模型","工作流","智能体"],"updated":"2025-02-20T00:59:52.799Z","content":"<h2 id=\"1-需求分析\">1. 需求分析<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#1-需求分析\"></a></h2><p>在 Dify 中构建一个基于大模型的发票识别 Agent 主要包括以下目标：</p>\n<ul>\n<li>识别发票中的关键信息（如发票代码、发票号码、开票日期、金额等）。</li>\n<li>解析发票图片或 PDF 文件。</li>\n<li>结合大模型进行文本理解，提高 OCR 识别的准确性。</li>\n<li>将提取的信息结构化存储，便于查询和处理。</li>\n<li>可扩展支持不同类型的发票格式（如增值税普通发票、专用发票等）。</li>\n</ul>\n<h2 id=\"2-准备工作\">2. 准备工作<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#2-准备工作\"></a></h2><h3 id=\"2-1-环境搭建\">2.1 环境搭建<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#2-1-环境搭建\"></a></h3><ul>\n<li>注册并登录 <a href=\"https://dify.ai\" target=\"_blank\" rel=\"noopener\">Dify</a> 平台。</li>\n<li>创建一个新的 Agent。</li>\n<li>确保拥有 OCR 识别能力，可选择以下方式：<ul>\n<li>使用 Dify 内置的文档解析功能（如果支持）。</li>\n<li>调用第三方 OCR API，如 <strong>百度 OCR</strong>、<strong>腾讯 OCR</strong>、<strong>阿里云 OCR</strong>。</li>\n<li>本地部署 OCR 方案，如 <strong>PaddleOCR</strong>。</li>\n</ul>\n</li>\n<li>选择适合的 <strong>大模型</strong>（如 DeepSeek、GPT-4、Claude）进行发票字段解析。</li>\n</ul>\n<h2 id=\"3-方案设计\">3. 方案设计<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#3-方案设计\"></a></h2><h3 id=\"3-1-确定数据输入格式\">3.1 确定数据输入格式<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#3-1-确定数据输入格式\"></a></h3><ul>\n<li><strong>图片格式</strong>（JPG、PNG、TIFF）。</li>\n<li><strong>PDF 文件</strong>（单页或多页）。</li>\n<li><strong>文本格式</strong>（OCR 识别后返回的 JSON 结构）。</li>\n</ul>\n<h3 id=\"3-2-识别关键信息\">3.2 识别关键信息<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#3-2-识别关键信息\"></a></h3><ul>\n<li><p><strong>基础字段</strong>：</p>\n<ul>\n<li>发票代码</li>\n<li>发票号码</li>\n<li>开票日期</li>\n<li>购方名称</li>\n<li>购方税号</li>\n<li>金额（不含税/含税）</li>\n<li>税额</li>\n<li>销方名称</li>\n<li>销方税号</li>\n</ul>\n</li>\n<li><p><strong>扩展字段</strong>（可选）：</p>\n<ul>\n<li>货物或服务明细</li>\n<li>校验码</li>\n<li>备注信息</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"3-3-结合大模型进行解析\">3.3 结合大模型进行解析<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#3-3-结合大模型进行解析\"></a></h3><ul>\n<li><strong>OCR 方案</strong>（如 PaddleOCR、百度 OCR）。</li>\n<li><strong>大模型处理流程</strong>：<ol>\n<li>先通过 OCR 获取发票的文本内容。</li>\n<li>传递 OCR 结果给大模型，如 DeepSeek 或 GPT-4。</li>\n<li>让大模型解析关键信息，并返回 JSON 格式的数据。</li>\n<li>可结合 RAG（检索增强生成）方法，提高解析准确性。</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"4-Dify-Agent-实现步骤\">4. Dify Agent 实现步骤<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#4-Dify-Agent-实现步骤\"></a></h2><h3 id=\"4-1-创建-Agent\">4.1 创建 Agent<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#4-1-创建-Agent\"></a></h3><ul>\n<li>在 Dify 仪表盘创建新的 Agent。</li>\n<li>选择 <strong>自定义 Agent</strong> 作为类型。</li>\n<li>配置 API 访问权限。</li>\n</ul>\n<h3 id=\"4-2-添加数据处理能力\">4.2 添加数据处理能力<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#4-2-添加数据处理能力\"></a></h3><ul>\n<li>配置 <strong>OCR 解析</strong>，调用外部 OCR 识别发票文本。</li>\n<li>配置 <strong>大模型 API 调用</strong> 连接 DeepSeek 或 GPT-4 进行信息提取。</li>\n</ul>\n<h3 id=\"4-3-配置-Prompt-和工作流\">4.3 配置 Prompt 和工作流<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#4-3-配置-Prompt-和工作流\"></a></h3><ul>\n<li><p>设定 Prompt，引导大模型解析发票字段，例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">你是一个发票识别助手，你的任务是从 OCR 识别结果中提取关键字段。</span><br><span class=\"line\">例如：</span><br><span class=\"line\">- 发票代码：</span><br><span class=\"line\">- 发票号码：</span><br><span class=\"line\">- 开票日期：</span><br><span class=\"line\">- 购方名称：</span><br><span class=\"line\">- 购方税号：</span><br><span class=\"line\">...</span><br><span class=\"line\">请按照 JSON 格式返回。</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>设定输出格式（JSON 或结构化文本）。</p>\n</li>\n</ul>\n<h3 id=\"4-4-连接-OCR-和大模型\">4.4 连接 OCR 和大模型<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#4-4-连接-OCR-和大模型\"></a></h3><ul>\n<li>通过 Dify 的 API 请求 OCR 识别。</li>\n<li>解析 OCR 结果并输入大模型进行信息提取。</li>\n<li>处理大模型的输出，确保格式正确。</li>\n</ul>\n<h2 id=\"5-测试与优化\">5. 测试与优化<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#5-测试与优化\"></a></h2><h3 id=\"5-1-测试识别效果\">5.1 测试识别效果<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#5-1-测试识别效果\"></a></h3><ul>\n<li>上传不同类型的发票测试。</li>\n<li>调整 Prompt 以优化信息提取。</li>\n<li>处理 OCR 误差，提高准确性。</li>\n<li>评估大模型在不同类型发票上的表现。</li>\n</ul>\n<h3 id=\"5-2-优化-API-调用\">5.2 优化 API 调用<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#5-2-优化-API-调用\"></a></h3><ul>\n<li>采用 <strong>缓存机制</strong> 避免重复请求 OCR 和大模型服务。</li>\n<li>对 <strong>错误信息</strong> 进行异常处理，提高稳定性。</li>\n<li>通过 <strong>日志分析</strong> 监测识别准确率。</li>\n</ul>\n<h2 id=\"6-部署与维护\">6. 部署与维护<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#6-部署与维护\"></a></h2><h3 id=\"6-1-部署方式\">6.1 部署方式<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#6-1-部署方式\"></a></h3><ul>\n<li><strong>Dify 在线部署</strong>（直接通过 Web 应用使用）。</li>\n<li><strong>API 集成</strong>（供企业系统调用）。</li>\n</ul>\n<h3 id=\"6-2-维护与升级\">6.2 维护与升级<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#6-2-维护与升级\"></a></h3><ul>\n<li>监控识别成功率，定期优化 Prompt。</li>\n<li>添加新发票类型的支持。</li>\n<li>根据法律法规调整字段解析规则。</li>\n</ul>\n<h2 id=\"7-遇到的问题\">7. 遇到的问题<a href=\"post/使用 Dify 创建基于大模型的发票识别 Agent#7-遇到的问题\"></a></h2><div class=\"article-bounded\"><div class=\"article-table\"><table>\n<thead>\n<tr>\n<th>问题</th>\n<th>可能原因</th>\n<th>解决方案</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>OCR 识别错误</td>\n<td>文字模糊、印刷质量差</td>\n<td>更换高清图片，调整 OCR 预处理参数</td>\n</tr>\n<tr>\n<td>关键字段缺失</td>\n<td>Prompt 设计不合理</td>\n<td>优化 Prompt 逻辑，尝试示例引导</td>\n</tr>\n<tr>\n<td>JSON 输出格式错误</td>\n<td>LLM 解析错误</td>\n<td>增加格式约束，调试大模型输出</td>\n</tr>\n<tr>\n<td>大模型误识别</td>\n<td>训练数据不足</td>\n<td>调整 Prompt，并结合 RAG 增强理解</td>\n</tr>\n</tbody>\n</table></div></div>\n","next":{"title":"Windows 安装 Dify 详细指南","slug":"Windows 安装 Dify 详细指南"},"link":"https://www.alipay.one/post/使用 Dify 创建基于大模型的发票识别 Agent/","toc":[{"title":"1. 需求分析","id":"1-需求分析","index":"1"},{"title":"2. 准备工作","id":"2-准备工作","index":"2","children":[{"title":"2.1 环境搭建","id":"2-1-环境搭建","index":"2.1"}]},{"title":"3. 方案设计","id":"3-方案设计","index":"3","children":[{"title":"3.1 确定数据输入格式","id":"3-1-确定数据输入格式","index":"3.1"},{"title":"3.2 识别关键信息","id":"3-2-识别关键信息","index":"3.2"},{"title":"3.3 结合大模型进行解析","id":"3-3-结合大模型进行解析","index":"3.3"}]},{"title":"4. Dify Agent 实现步骤","id":"4-Dify-Agent-实现步骤","index":"4","children":[{"title":"4.1 创建 Agent","id":"4-1-创建-Agent","index":"4.1"},{"title":"4.2 添加数据处理能力","id":"4-2-添加数据处理能力","index":"4.2"},{"title":"4.3 配置 Prompt 和工作流","id":"4-3-配置-Prompt-和工作流","index":"4.3"},{"title":"4.4 连接 OCR 和大模型","id":"4-4-连接-OCR-和大模型","index":"4.4"}]},{"title":"5. 测试与优化","id":"5-测试与优化","index":"5","children":[{"title":"5.1 测试识别效果","id":"5-1-测试识别效果","index":"5.1"},{"title":"5.2 优化 API 调用","id":"5-2-优化-API-调用","index":"5.2"}]},{"title":"6. 部署与维护","id":"6-部署与维护","index":"6","children":[{"title":"6.1 部署方式","id":"6-1-部署方式","index":"6.1"},{"title":"6.2 维护与升级","id":"6-2-维护与升级","index":"6.2"}]},{"title":"7. 遇到的问题","id":"7-遇到的问题","index":"7"}]}